---
layout: post
title: (WIP) GraphQL Reference Guide
tags: [GraphQL, Data]
category: FINALIZED
color: rgb(255, 105, 132)
feature-img: "assets/img/post-cover/31-cover.png"
thumbnail: "assets/img/post-cover/31-cover.png"
author: QubitPi
excerpt_separator: <!--more-->
---

<!--more-->

* TOC
{:toc}


GraphQL Specification
---------------------

### Document

> ```g4
> document : definition+;
> 
> definition : operationDefinition
>            | fragmentDefinition
>            | typeSystemDefinition
>            | typeSystemExtension
>            ;
> ```

A GraphQL **Document** is an ANTLR sequence of _definitions_. There are 3 types of definitions:

1. **Executable Definition**, which can either be a
   - [Operation Definition](#operation-definition), or
   - Fragment Definition
2. Type System Definition
3. Type System Extension

A GraphQL **Document** describes a complete file or request string operated on by a GraphQL service or client. A
document contains multiple definitions, either executable or representative of a GraphQL type system.

Documents are only executable by a GraphQL service if they contain an _Operation Definition_ and otherwise only contain 
_Executable Definition_. Documents which DO NOT contain _Operation Definition_ or DO contain _TypeSystem Definition or 
TypeSystem Extension_, however, may still be parsed and validated to allow client tools to represent many GraphQL uses 
which may appear across many individual files.

If a Document contains only one operation, that operation may be unnamed or represented in the shorthand form, which
omits both the query keyword and operation name. Otherwise, if a GraphQL Document contains multiple operations, each 
operation must be named. **When submitting a Document with multiple operations to a GraphQL service, the name of the
desired operation to be executed must also be provided.**

> To provide the desired operation to be executed from the following document containing 2 operations, for example
> 
> ```graphql
> query getTaskAndUser {
>     getTask(id: "0x3") {
>         id
>         title
>         completed
>     }
> 
>     queryUser(filter: {username: {eq: "Klee"}}) {
>         username
>         name
>     }
> }
> 
> query completedTasks {
>     queryTask(filter: {completed: true}) {
>         title
>         completed
>     }
> }
> ```
> 
> When executing the request above (as an HTTP POST request in JSON format), specifying the "getTaskAndUser" operation 
> executes the first query:
> 
> ```json
> {
>     "query": "query getTaskAndUser { ... } \n query completedTasks { ... }",
>     "operationName": "getTaskAndUser"
> }
> ```

GraphQL services which only seek to provide GraphQL query execution may choose to only include _Executable Definition_
and omit the _Type System Definition_ and _Type System Extension_ rules from Definition.

### Operation Definition

> ```g4
> operationDefinition : selectionSet
>                     | operationType  name? variableDefinitions? directives? selectionSet
>                     ;
> ```

An **operation** is either

* a [set of selection](#selection-set), or
* a set of selection with operation

### Selection Set

```g4
selectionSet : '{' selection+ '}';

selection : field
          | fragmentSpread
          | inlineFragment
          ;
```

An operation selects the set of information it needs, and will receive exactly that information and nothing more,
avoiding over-fetching and under-fetching data. For example

```graphql
{
    id
    firstName
    lastName
}
```

In this query, the id, firstName, and lastName fields form a selection set. Selection sets may also contain fragment 
references.

### Fields

```g4
field : alias? name arguments? directives? selectionSet?;
```

A selection set is primarily composed of fields. A field describes one discrete piece of information available to
request within a selection set.

Some fields describe complex data or relationships to other data. In order to further explore this data, a field may 
itself contain a selection set, allowing for deeply nested requests. _All GraphQL operations must specify their
selections down to fields which return scalar values to ensure an unambiguously shaped response_.

For example, this operation selects fields of complex data and relationships down to scalar values.

```graphql
{
    me {
        id
        firstName
        lastName
        birthday {
            month
            day
        }
        friends {
            name
        }
    }
}
```

Fields in the top-level selection set of an operation often represent some information that is globally accessible to an
application and its current viewer. Some typical examples of these top fields include reference to a currently logged-in
viewer, or accessing certain types of data referenced by a unique identifier. For instance

```graphql
# `me` could represent the currently logged in viewer.
{
    me {
        name
    }
}

# `user` represents one of many users in a graph of data, referred to by a
# unique identifier.
{
    user(id: 4) {
        name
    }
}
```

### Arguments

```g4
arguments : '(' argument+ ')';

argument : name ':' valueWithVariable;
```

**Fields are conceptually functions** which return values; they occasionally accept **arguments** which alter their
behavior. These arguments often map directly to function arguments within a GraphQL server's implementation.

In the example below, we query a specific user (requested via the `id` argument) and their profile picture of a specific
size:

```graphql
{
    user(id: 4) {
        id
        name
        profilePic(size: 100)
    }
}
```

In addition, multiple arguments can exist for a given field:

```graphql
{
    user(id: 4) {
        id
        name
        profilePic(width: 100, height: 50)
    }
}
```

> Arguments are unorderd
> 
> Arguments may be provided in any syntactic order and maintain identical semantic meaning. For example, the following
> two queries are semantically identical:
> 
> ```graphql
> {
>     picture(width: 200, height: 100)
> }
> ```
> 
> ```graphql
> {
>     picture(height: 100, width: 200)
> }
> ```


GraphQL Java
------------

### Query Parser

We can parse a GraphQL query string into a programmable Java object, i.e. a [Document](#document), even without knowing
schema. For example:

```java
import graphql.language.Document;
import graphql.parser.Parser;

Parser parser = new Parser(); 
Document document = parser.parseDocument("{  Instrument(id: \"1234\") {    Reference {      Name    }  }}");
```
