---
layout: post
title: Docker Basics
tags: [Docker, Virtualization]
category: FINALIZED
color: rgb(43, 164, 78)
feature-img: "assets/img/post-cover/32-cover.png"
thumbnail: "assets/img/post-cover/32-cover.png"
author: QubitPi
excerpt_separator: <!--more-->
---

<!--more-->

* TOC
{:toc}


Concepts
--------

### Volumes

Volumes are the preferred mechanism for persisting data generated by and used by Docker containers. 


Docker cAdvisor
---------------

[cAdvisor](https://github.com/google/cadvisor) (Container Advisor) provides Docker container users an understanding of
the resource usage and performance characteristics of their running containers. It is a running daemon that collects, 
aggregates, processes, and exports information about running containers. Specifically, for each container it keeps 
resource isolation parameters, historical resource usage, histograms of complete historical resource usage and network 
statistics. This data is exported by container and machine-wide.

Although [cAdvisor](https://github.com/google/cadvisor) has some prelimilary (useful though) UI. It also offers

1. [RESTful API to query container stats](https://github.com/google/cadvisor/blob/master/docs/api.md)
2. [Export capability to common data storage, such as Elasticsearch](https://github.com/google/cadvisor/blob/master/docs/storage/README.md)

To pull the image and run it:

    sudo docker run   --volume=/:/rootfs:ro   --volume=/var/run/docker.sock:/var/run/docker.sock:rw  --volume=/sys:/sys:ro   --volume=/var/lib/docker/:/var/lib/docker:ro   --volume=/dev/disk/:/dev/disk:ro   --publish=8080:8080   --detach=true   --name=cadvisor   --privileged   --device=/dev/kmsg   gcr.io/cadvisor/cadvisor:v0.36.0

![cAdvisor Screenshot 1]({{ "/assets/img/cadvisor-1.png" | relative_url}})
![cAdvisor Screenshot 2]({{ "/assets/img/cadvisor-2.png" | relative_url}})

### [docker-container-stats](https://github.com/virtualzone/docker-container-stats)

[cAdvisor](https://github.com/google/cadvisor) is good for customizing container monitoring, but it's heavy. A
quick-and-lightweight option would be [docker-container-stats](https://github.com/virtualzone/docker-container-stats)

![docker-container-stats Screenshot]({{ "/assets/img/docker-container-stats.png" | relative_url}})


Docker Troubleshooting
----------------------

### Container

If a container is **not running**:

```
$ docker ps -a
CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS                      PORTS     NAMES
234rgfq34tg3   image/name          "â€¦"                18 minutes ago   Exited (1) 18 minutes ago             container-name
```

We can retrospect it using

    docker logs 234rgfq34tg3

or

    docker logs container-name

**To enter in a Docker container** already running with a new TTY, with docker 1.3, there is a new command
[**docker exec**](https://docs.docker.com/engine/reference/commandline/exec/). This allows us to enter a running
container:

    docker exec -it [container-id] bash

> This assumes `bash` is installed on our container. We may run `sh` or whatever interactive shell is installed on the
> container.


### Proxy

```bash
% docker pull ubuntu:latest
Error response from daemon: Get https://registry-1.docker.io/v2/: net/http: request canceled while waiting for
connection (Client.Timeout exceeded while awaiting headers)
```

This usually means you need to setup proxy on your local machine. Ignoring all details about proxy, you need to make
the following Docker Desktop configuration. To do it(on Mac), click the little Docker logo on the top bar of your
screen. Click "Resources" and then hit "PROXIES" in the dropdown menu. You should see a configuration window like the
following:

![Error loading docker-proxy-config.png]({{ "/assets/img/docker-proxy-config.png" | relative_url}})

Note that configuring proxy in `~/.bashrc` is not the same thing as doing the config above. Docker Desktop doesn't look
at the `~/.bashrc` for proxy settings.
